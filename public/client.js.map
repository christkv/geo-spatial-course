{"version":3,"sources":["admin_client.js","mobile_client.js","shared.js"],"names":["AdminClient","options","mymap","currentLocation","currentLocationMarker","intervalId","nextPubIndex","prototype","setup","self","mapDivId","accessToken","bigmapheight","smallmapheight","mapbreakwidth","highzoom","lowzoom","initzoom","optionLocation","location","searchPubs","pubs","locationDistance","initialCoordinates","center","L","map","setView","$","width","height","invalidateSize","on","e","newSize","x","setZoom","css","tileLayer","zoom","maxZoom","attribution","id","addTo","getGeoLocation","err","console","log","alert","latitude","longitude","layer","geoJSON","geometry","bindTooltip","placeName","circle","color","fillColor","fillOpacity","radius","forEach","pub","name","addPub","index","markerOptions","weight","opacity","pointToLayer","feature","latlng","circleMarker","onEachFeature","length","type","coordinates","flyTo","latLng","getZoom","postJSON","url","parseJSON","result","setDiv","PubCrawlClient","callback","pubCrawl","marker","updateAttendantLocation","setInterval","updateLocation","setLatLng","loadAttendants","crawlId","_id","getJSON","centerNextPub","pubIndex","extractPubPoint","getLatLng","mobileSetup","Location","doc","timestamp","accuracy","altitude","altitudeAccuracy","speed","obj","enableHighAccuracy","maximumAge","timeout","geoSuccess","position","coords","geoError","error","navigator","geolocation","getCurrentPosition","object","xhr","XMLHttpRequest","open","setRequestHeader","onload","status","JSON","parse","responseText","send","stringify","text","document","getElementById","innerHTML"],"mappings":"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","file":"client.js","sourcesContent":["var AdminClient = function(options) {\n  this.mymap = null;\n  this.currentLocation = null;\n  this.currentLocationMarker = null;\n  this.intervalId = null;\n  this.options = options;\n  \n  // current look up pub index\n  this.nextPubIndex = 0;\n}\n\nAdminClient.prototype.setup = function() {\n  var self = this;\n  var mapDivId = self.options.mapDivId;\n  var accessToken = self.options.accessToken;\n\n  // Set up some variables to track map size for\n  var bigmapheight = 600;\n  var smallmapheight = 400;\n  var mapbreakwidth = 600;\n  var highzoom = 8;\n  var lowzoom = 7;\n  var initzoom;\n\n  // Unpack options\n  var optionLocation = self.options.location\n  var searchPubs = self.options.searchPubs;\n  var pubs = self.options.pubs;\n  var locationDistance = self.options.locationDistance;\n  \n  // Set the initial coordinates\n  var initialCoordinates = [51.503605, -0.106506];\n\n  // Override the location\n  if (optionLocation && optionLocation.center) {\n    initialCoordinates = [optionLocation.center[1], optionLocation.center[0]];  \n  }\n\n  // Create the mapbox view\n  self.mymap = L.map(mapDivId).setView(initialCoordinates, 1);\n\n  //Set initial mapheight, based on the calculated width of the map container\n  if ($(\"#\" + mapDivId).width() > mapbreakwidth) {\n    initzoom = highzoom;\n    $(\"#\" + mapDivId).height(bigmapheight);\n  } else {\n    initzoom = lowzoom;\n    $(\"#\" + mapDivId).height(smallmapheight);\n  };\n\n  // Invalidate the size of the map\n  self.mymap.invalidateSize();\n  //Use Leaflets resize event to set new map height and zoom level\n  self.mymap.on('resize', function(e) {\n    if (e.newSize.x < mapbreakwidth) {\n      self.mymap.setZoom(lowzoom);\n      $(\"#\" + mapDivId).css('height', smallmapheight);\n      self.mymap.invalidateSize();\n    };\n    \n    if (e.newSize.x > mapbreakwidth) {\n      self.mymap.setZoom(highzoom);\n      $(\"#\" + mapDivId).css('height', bigmapheight);\n      self.mymap.invalidateSize();\n    };\n  });\n\n  // Set up the map\n  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=' + accessToken, {\n    zoom: initzoom,\n    maxZoom: 18,\n    attribution: 'Map data &copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors, ' +\n      '<a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, ' +\n      'Imagery © <a href=\"https://www.mapbox.com/\">Mapbox</a>',\n    id: 'mapbox.streets'\n  }).addTo(self.mymap);\n\n  // Get the current location\n  getGeoLocation(function(err, location) {\n    if (err) {\n      if (typeof console != 'undefined') console.log(err);\n      return alert(\"Please Enable Location Support, and reload the page\");\n    }\n\n    // Save the current location\n    self.currentLocation = [location.latitude, location.longitude];\n\n    // Override the location\n    if (optionLocation && optionLocation.center) {\n      self.currentLocation = [optionLocation.center[1], optionLocation.center[0]];  \n    }\n\n    // Center the map on the location\n    self.mymap.setView(self.currentLocation, 16)\n\n    // Location is defined, draw on the map\n    if (optionLocation && optionLocation.center) {\n      // Add starting point shape\n      var layer = L.geoJSON(optionLocation.geometry);\n      layer.bindTooltip(optionLocation.placeName);\n      layer.addTo(self.mymap);\n\n      // Create circle\n      L.circle([optionLocation.center[1], optionLocation.center[0]], {\n        color: 'red',\n        fillColor: '#f03',\n        fillOpacity: 0.5,\n        radius: locationDistance\n      }).addTo(self.mymap);\n    }\n\n    // Render any of search result pubs\n    searchPubs.forEach(function(pub) {\n      var layer = L.geoJSON(pub.geometry)\n      layer.bindTooltip(pub.name);\n      layer.on('click', function() { \n        addPub(self.options, pub);\n      });\n\n      layer.addTo(self.mymap);\n    });\n\n    // Render any pubs in the walk\n    pubs.forEach(function(pub, index) {\n      var markerOptions = {\n        radius: 12, fillColor: \"green\", color: \"#000\",\n        weight: 1, opacity: 1, fillOpacity: 0.8      \n      }\n\n      L.geoJSON(pub.geometry, {\n        pointToLayer: function(feature, latlng) {\n          return L.circleMarker(latlng, markerOptions);\n        },\n        onEachFeature: function(feature, layer) {\n          layer.bindTooltip(\"\" + index + \". \" + pub.name);\n        }\n      }).addTo(self.mymap);\n    });\n   \n    // If we have some pubs move to them\n    if (searchPubs.length) {\n      // Get the first element\n      if (searchPubs[0].geometry.type == \"Point\") {\n        var coordinates = [\n          searchPubs[0].geometry.coordinates[1], \n          searchPubs[0].geometry.coordinates[0]];  \n      } else {\n        var coordinates = [\n          searchPubs[0].geometry.coordinates[0][0][1], \n          searchPubs[0].geometry.coordinates[0][0][0]];\n      }\n\n      self.mymap.flyTo(\n        L.latLng(coordinates), \n        self.mymap.getZoom());\n    }\n  });\n}\n\nfunction addPub(options, pub) {\n  // Post the pub id\n  postJSON(options.url + \"/add/\" + options.id, pub, { parseJSON: false }, function(err, result) {\n    if (err) {\n      return alert(\"Failed to add pub to the pub crawl\");\n    }\n\n    // We have the list of pubs\n    setDiv(\"pubs\", result);\n  });\n}","var PubCrawlClient = function(options) {\n  this.mymap = null;\n  this.currentLocation = null;\n  this.currentLocationMarker = null;\n  this.intervalId = null;\n  this.options = options;\n  \n  // current look up pub index\n  this.nextPubIndex = 0;\n}\n\nPubCrawlClient.prototype.setup = function(callback) {\n  var self = this;\n\n  getGeoLocation(function(err, location) {\n    if (err) {\n      if (typeof console != 'undefined') console.log(err);\n      return alert(\"Please Enable Location Support, and reload the page\");\n    }\n\n    // Unpack fields\n    self.pubs = self.options.pubCrawl && self.options.pubCrawl.pubs\n      ? self.options.pubCrawl.pubs\n      : [];\n\n    // Save the current location\n    self.currentLocation = [location.latitude, location.longitude];\n    // Create the mapbox view\n    self.mymap = L.map(self.options.mapDivId).setView(self.currentLocation, 18);\n    // Set up the map\n    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=' + self.options.accessToken, {\n      maxZoom: 18,\n      attribution: 'Map data &copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors, ' +\n        '<a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, ' +\n        'Imagery © <a href=\"https://www.mapbox.com/\">Mapbox</a>',\n      id: 'mapbox.streets'\n    }).addTo(self.mymap);\n\n    // Create the current marker\n    self.currentLocationMarker = L.marker(self.currentLocation);\n    self.currentLocationMarker.addTo(self.mymap);\n\n    // Render all the pub crawl pubs\n    self.pubs.forEach(function(pub, index) {\n      var markerOptions = {\n        radius: 12, fillColor: \"green\", color: \"#000\",\n        weight: 1, opacity: 1, fillOpacity: 0.8      \n      }\n\n      L.geoJSON(pub.geometry, {\n        pointToLayer: function(feature, latlng) {\n          return L.circleMarker(latlng, markerOptions);\n        },\n        onEachFeature: function(feature, layer) {\n          layer.bindTooltip(\"\" + index + \". \" + pub.name);\n        }\n      }).addTo(self.mymap);\n    });\n\n    // Invalidate size\n    self.invalidateSize();\n\n    // Update the attendant lcoation\n    updateAttendantLocation(self.currentLocation);\n\n    // Start current location update\n    self.intervalId = setInterval(updateLocation(self), 1000);\n  });\n}\n\nfunction updateLocation(self) {\n  return function() {\n    getGeoLocation(function(err, location) {\n      if (err) return;\n      // Skip everything if the location is the same\n      if (location.latitude == self.currentLocation[0]\n          && location.longitude == self.currentLocation[1]) {\n            return;\n          }\n\n      // Save the current location\n      self.currentLocation = [location.latitude, location.longitude];\n      // Update the current marker location\n      self.currentLocationMarker.setLatLng(L.latLng(self.currentLocation));\n      // Update the attendant lcoation\n      updateAttendantLocation(self.currentLocation);\n    });  \n  }\n}\n\nfunction updateAttendantLocation(coordinates) {\n  postJSON('/mobile/location', {\n    latitude: coordinates[0],\n    longitude: coordinates[1]\n  }, { parseJSON: false }, function(err, result) {});\n}\n\nPubCrawlClient.prototype.invalidateSize = function() {\n  if (this.mymap) {\n    this.mymap.invalidateSize();\n  }\n}\n\nPubCrawlClient.prototype.loadAttendants = function(id, callback) {\n  // Unpack crawlId\n  var crawlId = this.options.pubCrawl && this.options.pubCrawl._id\n    ? this.options.pubCrawl._id\n    : null;\n\n  getJSON('/mobile/attendants/' + crawlId, \n    { parseJSON: false}, function(err, result) {\n      if (err) return alert(err);\n      setDiv(id, result);\n\n      if (callback) callback(err, result);\n    });\n}\n\nPubCrawlClient.prototype.centerNextPub = function() {\n  if (this.pubs.length) {\n    // Get this or next index\n    var pubIndex = this.nextPubIndex++ % this.pubs.length;\n    // Get the next pub\n    var pub = this.pubs[pubIndex];\n    // Center the map on the pub\n    this.mymap.flyTo(extractPubPoint(pub), this.mymap.getZoom());\n  }    \n}\n\nfunction extractPubPoint(pub) {\n  // Get the first element\n  if (pub.geometry.type == \"Point\") {\n    var coordinates = [\n      pub.geometry.coordinates[1], \n      pub.geometry.coordinates[0]];  \n  } else {\n    var coordinates = [\n      pub.geometry.coordinates[0][0][1], \n      pub.geometry.coordinates[0][0][0]];\n  }\n\n  return L.latLng(coordinates);\n}\n\nPubCrawlClient.prototype.center = function() {\n  if (this.currentLocation) {\n    // Update the marker with the current location\n    this.currentLocationMarker.setLatLng(this.currentLocation);    \n    // Center the map on the current location marker\n    this.mymap.setView(this.currentLocationMarker.getLatLng(),this.mymap.getZoom()); \n  }\n}\n\nfunction mobileSetup(options) {\n  getGeoLocation((err, location) => {\n    // Get any pub crawls in your area\n    postJSON('/mobile', location, { parseJSON: false }, function(err, result) {\n      if (err) return console.log(err);\n      setDiv('crawls', result);\n    });\n  });\n}","class Location {\n  constructor(doc) {\n    this.timestamp = doc.timestamp;\n    this.latitude = doc.latitude;\n    this.longitude = doc.longitude;\n    this.accuracy = doc.accuracy;\n    this.altitude = doc.altitude;\n    this.altitudeAccuracy = doc.altitudeAccuracy;\n    this.speed = doc.speed;\n  }\n\n  toArray() {\n    return [this.latitude, this.longitude];\n  }\n\n  equals(obj) {\n    if (obj == null) return false;\n    if (obj.latitude != this.latitude) return false;\n    if (obj.longitude != this.longitude) return false;\n    return true;\n  }\n}\n\nfunction getGeoLocation(callback, options) {\n  options = options || {\n    enableHighAccuracy: false,\n    maximumAge: 1000 * 60,\n    timeout: 1000 * 10\n  };\n\n  var geoSuccess = function(position) {\n    var location = new Location({\n      accuracy: position.coords.accuracy,\n      altitude: position.coords.altitude,\n      altitudeAccuracy: position.coords.altitudeAccuracy,\n      latitude: position.coords.latitude,\n      longitude: position.coords.longitude,\n      speed: position.coords.speed,\n      timestamp: position.timestamp\n    });\n\n    callback(null, location);\n  }\n\n  var geoError = function(error) {\n    callback(error);\n  }\n\n  navigator.geolocation.getCurrentPosition(geoSuccess, geoError, options);\n}\n\n/**\n * Simple AJAX POST method\n */\nfunction postJSON(url, object, options, callback) {\n  if (typeof options === 'function') (callback = options), (options = {});\n  \n  var xhr = new XMLHttpRequest();\n  xhr.open('POST', url);\n  xhr.setRequestHeader('Content-Type', 'application/json');\n  xhr.onload = function() {\n    // Valid XML Request response\n    if (xhr.status !== 200) {\n      return callback('Request failed.  Returned status of ' + xhr.status);\n    }\n\n    // Return the result\n    callback(null, options.parseJSON ? JSON.parse(xhr.responseText) : xhr.responseText);\n  };\n\n  xhr.send(JSON.stringify(object));\n}\n\n/**\n * Simple AJAX GET method\n */\nfunction getJSON(url, options, callback) {\n  if (typeof options === 'function') (callback = options), (options = {});\n  \n  var xhr = new XMLHttpRequest();\n  xhr.open('GET', url);\n  xhr.setRequestHeader('Content-Type', 'application/json');\n  xhr.onload = function() {\n    // Valid XML Request response\n    if (xhr.status !== 200) {\n      return callback('Request failed.  Returned status of ' + xhr.status);\n    }\n\n    // Return the result\n    callback(null, options.parseJSON ? JSON.parse(xhr.responseText) : xhr.responseText);\n  };\n\n  xhr.send();\n}\n\nfunction setDiv(id, text) {\n  document.getElementById(id).innerHTML = text;\n}\n\n"]}